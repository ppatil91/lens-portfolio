{% extends "base.html" %}

{% block content %}
<div class="animate-fade-in max-w-4xl mx-auto">
    <header class="mb-8 flex justify-between items-center border-b border-brandBorder/50 pb-4">
        <div>
            <h1 class="text-3xl font-bold mb-2 flex items-center gap-2"><i
                    class="ph ph-chat-circle-text text-brandAccent"></i> Messages</h1>
            <p class="text-gray-400 text-sm">Your recent conversations</p>
        </div>
        <a href="{{ url_for('explore') }}"
            class="text-sm text-brandAccent hover:text-brandAccentHover transition-colors flex items-center gap-1">
            <i class="ph ph-plus"></i> New Message
        </a>
    </header>

    <div class="bg-brandCard border border-brandBorder rounded-xl shadow-lg overflow-hidden">
        {% if conversations %}
        <ul class="divide-y divide-brandBorder/50">
            {% for convo in conversations %}
            <li>
                <a href="{{ url_for('chat', user_id=convo.user.id) }}"
                    class="flex items-start gap-4 p-5 hover:bg-brandSidebar transition-colors group relative block">
                    <!-- Avatar -->
                    <div class="w-12 h-12 rounded-full overflow-hidden bg-gray-700 flex-shrink-0">
                        {% if convo.user.profile_image == 'default_profile.jpg' %}
                        <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=150&auto=format&fit=crop"
                            class="w-full h-full object-cover">
                        {% else %}
                        <img src="{{ url_for('static', filename='uploads/' + convo.user.profile_image) }}"
                            class="w-full h-full object-cover">
                        {% endif %}
                    </div>

                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-baseline mb-1">
                            <h3 class="text-white font-bold truncate group-hover:text-brandAccent transition-colors">{{
                                convo.user.full_name }}</h3>
                            <time class="text-xs text-gray-500 whitespace-nowrap ml-3">{{
                                convo.last_message.timestamp.strftime('%b %d, %I:%M %p') }}</time>
                        </div>
                        <div class="flex justify-between items-center gap-3">
                            <p
                                class="text-sm {% if convo.unread_count > 0 %}text-white font-medium{% else %}text-gray-400{% endif %} truncate">
                                {% if convo.last_message.sender_id == current_user.id %}
                                <span class="text-gray-500">You: </span>
                                {% endif %}
                                {{ convo.last_message.content }}
                            </p>

                            {% if convo.unread_count > 0 %}
                            <span
                                class="bg-brandAccent text-brandBase text-xs font-bold px-2 py-0.5 rounded-full flex-shrink-0 animate-pulse">
                                {{ convo.unread_count }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </a>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="p-12 text-center flex flex-col items-center justify-center">
            <div
                class="w-16 h-16 rounded-full bg-brandSidebar flex items-center justify-center mb-4 border border-brandBorder">
                <i class="ph ph-chat-centered-text text-gray-500 text-3xl"></i>
            </div>
            <h3 class="text-lg font-bold mb-2">No messages yet</h3>
            <p class="text-gray-400 text-sm mb-6 max-w-sm">Connect with other photographers and send them a message to
                start a conversation.</p>
            <a href="{{ url_for('explore') }}"
                class="bg-brandAccent hover:bg-brandAccentHover text-brandBase text-sm font-medium px-5 py-2.5 rounded-lg transition-colors">
                Find People
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}