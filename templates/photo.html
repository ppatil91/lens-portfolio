<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LENS - {{ photo.title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brandBase: '#0f0f0f',
                        brandSidebar: '#141414',
                        brandCard: '#1a1a1a',
                        brandAccent: '#DDAA77',
                        brandBorder: '#232323'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0f0f0f;
            color: #ffffff;
        }

        /* Custom scrollbar for the sidebar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #141414;
        }

        ::-webkit-scrollbar-thumb {
            background: #232323;
            border-radius: 4px;
        }

        /* --- CUSTOM ANIMATIONS --- */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        .animate-slide-up {
            opacity: 0;
            /* starts hidden */
            animation: slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Staggered Delay Utilities */
        .delay-100 {
            animation-delay: 100ms;
        }

        .delay-200 {
            animation-delay: 200ms;
        }

        .delay-300 {
            animation-delay: 300ms;
        }

        .delay-400 {
            animation-delay: 400ms;
        }

        .delay-500 {
            animation-delay: 500ms;
        }
    </style>
</head>

<body class="flex flex-col md:flex-row h-screen font-sans antialiased overflow-hidden bg-black">

    <main class="flex-1 bg-black relative flex items-center justify-center group h-[60vh] md:h-screen animate-fade-in">

        <div
            class="absolute top-6 left-6 right-6 flex justify-between items-center z-10 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity duration-300">
            <a href="javascript:history.back()"
                class="flex items-center bg-black/50 hover:bg-black/80 backdrop-blur-md px-4 py-2 rounded-full text-sm font-medium transition-colors border border-white/10">
                <i class="ph ph-arrow-left mr-2"></i> Back
            </a>

            <button
                class="flex items-center bg-black/50 hover:bg-black/80 backdrop-blur-md p-2.5 rounded-full text-white transition-colors border border-white/10"
                onclick="document.body.requestFullscreen()">
                <i class="ph ph-arrows-out-simple text-lg"></i>
            </button>
        </div>

        <img src="{{ url_for('static', filename='uploads/' + photo.filename) }}" alt="{{ photo.title }}"
            class="w-full h-full object-contain p-4 md:p-12">
    </main>

    <aside
        class="w-full md:w-[400px] bg-brandSidebar border-l border-brandBorder flex flex-col h-[40vh] md:h-screen shrink-0 overflow-y-auto animate-fade-in delay-100">

        <div class="p-6 border-b border-brandBorder/50 flex items-center justify-between animate-slide-up delay-200">
            <a href="{{ url_for('portfolio', user_id=photo.photographer.id) }}"
                class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                <div class="w-10 h-10 rounded-full bg-gray-700 overflow-hidden shrink-0">
                    {% if photo.photographer.profile_image == 'default_profile.jpg' %}
                    <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=150&auto=format&fit=crop"
                        class="w-full h-full object-cover">
                    {% else %}
                    <img src="{{ url_for('static', filename='uploads/' + photo.photographer.profile_image) }}"
                        class="w-full h-full object-cover">
                    {% endif %}
                </div>
                <div>
                    <h3 class="text-sm font-bold text-white">{{ photo.photographer.full_name }}</h3>
                    <p class="text-xs text-brandAccent">Photographer</p>
                </div>
            </a>
            </a>

            {% if current_user.is_authenticated and current_user != photo.photographer %}
            {% if current_user.is_connected_to(photo.photographer) %}
            <a href="{{ url_for('disconnect_user', user_id=photo.photographer.id) }}"
                class="text-xs font-semibold bg-transparent border border-gray-500 text-white px-4 py-1.5 rounded-full hover:bg-red-500 hover:border-red-500 transition-colors">
                Connected
            </a>
            {% else %}
            <a href="{{ url_for('connect_user', user_id=photo.photographer.id) }}"
                class="text-xs font-semibold bg-brandAccent text-[#0f0f0f] px-4 py-1.5 rounded-full hover:bg-[#cda06d] transition-colors">
                Connect
            </a>
            {% endif %}
            {% else %}
            <a href="{{ url_for('portfolio', user_id=photo.photographer.id) }}"
                class="text-xs font-semibold bg-white text-black px-4 py-1.5 rounded-full hover:bg-gray-200 transition-colors">
                View Profile
            </a>
            {% endif %}
        </div>

        <div class="p-6 flex-1">
            <h1 class="text-2xl font-bold mb-2 animate-slide-up delay-300">{{ photo.title }}</h1>
            <p class="text-sm text-gray-400 mb-6 animate-slide-up delay-400">{{ photo.category|title }} â€¢ Uploaded {{
                photo.upload_date.strftime('%b %d, %Y') }}</p>

            <div class="flex gap-3 mb-8 animate-slide-up delay-500">
                <!-- Functional Like AJAX Button -->
                <button onclick="likePhoto('{{ photo.id }}', this)"
                    class="w-full flex items-center justify-center gap-2 bg-brandCard border border-brandBorder hover:border-brandAccent/50 rounded-lg py-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg group">
                    <i class="ph ph-heart text-xl text-gray-400 group-hover:text-red-500 transition-colors"></i>
                    <span class="text-sm font-medium">Like Photo</span>
                </button>
                <button onclick="savePhoto('{{ photo.id }}', this)"
                    class="w-14 flex items-center justify-center bg-brandCard border border-brandBorder hover:border-brandAccent/50 rounded-lg py-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg group shrink-0">
                    {% if is_saved %}
                    <i
                        class="ph-fill ph-bookmark-simple text-xl text-brandAccent group-hover:text-white transition-colors"></i>
                    {% else %}
                    <i class="ph ph-bookmark-simple text-xl text-gray-400 group-hover:text-white transition-colors"></i>
                    {% endif %}
                </button>
                <button
                    class="w-14 flex items-center justify-center bg-brandCard border border-brandBorder hover:border-brandAccent/50 rounded-lg py-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg group shrink-0"
                    onclick="navigator.clipboard.writeText(window.location.href); alert('Link copied to clipboard!')">
                    <i class="ph ph-share-network text-xl text-gray-400 group-hover:text-white transition-colors"></i>
                </button>
            </div>

            {% if current_user.is_authenticated and current_user.id == photo.user_id %}
            <form action="{{ url_for('delete_photo', photo_id=photo.id) }}" method="POST"
                class="mb-8 animate-slide-up delay-500"
                onsubmit="return confirm('Are you sure you want to delete this photo forever?');">
                <button type="submit"
                    class="w-full flex items-center justify-center gap-2 bg-red-500/10 border border-red-500/20 text-red-500 hover:bg-red-500 hover:text-white rounded-lg py-3 transition-all duration-300 font-medium hover:-translate-y-1">
                    <i class="ph ph-trash text-xl"></i> Delete Photo
                </button>
            </form>
            {% endif %}

            <div class="grid grid-cols-2 gap-4 border-y border-brandBorder/50 py-5 mb-6 animate-slide-up delay-500">
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Views</p>
                    <p class="text-lg font-bold flex items-center gap-2">
                        <i class="ph-fill ph-eye text-blue-400"></i> {{ photo.views }}
                    </p>
                </div>
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Likes</p>
                    <p class="text-lg font-bold flex items-center gap-2 like-count-display">
                        <i class="ph-fill ph-heart text-red-500"></i> {{ photo.likes }}
                    </p>
                </div>
            </div>

            {% if photo.description %}
            <div class="mb-8">
                <h3 class="text-sm font-bold mb-2">Story behind the lens</h3>
                <p class="text-sm text-gray-400 leading-relaxed">
                    {{ photo.description }}
                </p>
            </div>
            {% endif %}

            {% if photo.location %}
            <div class="bg-brandCard rounded-lg p-4 mb-8">
                <div class="flex items-center gap-3">
                    <i class="ph ph-map-pin text-brandAccent text-xl"></i>
                    <span class="text-sm font-bold">{{ photo.location }}</span>
                </div>
            </div>
            {% endif %}

            {% if photo.tags %}
            <div class="mb-8">
                <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">Tags</h3>
                <div class="flex flex-wrap gap-2">
                    {% for tag in photo.tags.split(',') %}
                    <span
                        class="text-xs bg-[#1a1a1a] border border-[#333] px-3 py-1.5 rounded-full hover:border-brandAccent cursor-pointer transition-colors">{{
                        tag.strip() }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- COMMENTS SECTION -->
            <div class="mt-10 border-t border-brandBorder/50 pt-8 pb-20 animate-slide-up delay-500">
                <h3 class="text-lg font-bold mb-6 flex items-center gap-2">
                    <i class="ph ph-chat-circle"></i> Comments ({{ photo.comments|length }})
                </h3>

                {% if current_user.is_authenticated %}
                <form action="{{ url_for('comment_photo', photo_id=photo.id) }}" method="POST" class="mb-8">
                    <div class="flex gap-3">
                        <div class="w-8 h-8 rounded-full bg-gray-700 overflow-hidden shrink-0">
                            {% if current_user.profile_image == 'default_profile.jpg' %}
                            <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=150&auto=format&fit=crop"
                                class="w-full h-full object-cover">
                            {% else %}
                            <img src="{{ url_for('static', filename='uploads/' + current_user.profile_image) }}"
                                class="w-full h-full object-cover">
                            {% endif %}
                        </div>
                        <div class="flex-1 relative">
                            <input type="text" name="content" placeholder="Add a comment..." required
                                class="w-full bg-brandBase border border-brandBorder rounded-full pl-4 pr-12 py-2 text-sm focus:outline-none focus:border-brandAccent transition-colors">
                            <button type="submit"
                                class="absolute right-2 top-1/2 transform -translate-y-1/2 text-brandAccent hover:text-white p-1">
                                <i class="ph-fill ph-paper-plane-right"></i>
                            </button>
                        </div>
                    </div>
                </form>
                {% else %}
                <div class="bg-brandCard border border-brandBorder rounded-lg p-4 text-center mb-8">
                    <p class="text-sm text-gray-400 mb-2">Join the conversation</p>
                    <a href="{{ url_for('login') }}"
                        class="text-xs font-semibold bg-brandAccent text-[#0f0f0f] px-4 py-1.5 rounded-full hover:bg-[#cda06d] transition-colors inline-block">Sign
                        In to Comment</a>
                </div>
                {% endif %}

                <div class="space-y-6">
                    {% for comment in photo.comments|sort(attribute='timestamp', reverse=True) %}
                    <div class="flex gap-3 group">
                        <a href="{{ url_for('portfolio', user_id=comment.user.id) }}"
                            class="w-8 h-8 rounded-full bg-gray-700 overflow-hidden shrink-0">
                            {% if comment.user.profile_image == 'default_profile.jpg' %}
                            <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=150&auto=format&fit=crop"
                                class="w-full h-full object-cover">
                            {% else %}
                            <img src="{{ url_for('static', filename='uploads/' + comment.user.profile_image) }}"
                                class="w-full h-full object-cover">
                            {% endif %}
                        </a>
                        <div>
                            <div class="flex items-baseline gap-2 mb-1">
                                <a href="{{ url_for('portfolio', user_id=comment.user.id) }}"
                                    class="text-sm font-bold hover:text-brandAccent transition-colors">{{
                                    comment.user.full_name }}</a>
                                <span class="text-xs text-gray-500">{{ comment.timestamp.strftime('%b %d, %H:%M')
                                    }}</span>
                            </div>
                            <p class="text-sm text-gray-300 leading-relaxed">{{ comment.content }}</p>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <p class="text-sm text-gray-500">No comments yet. Be the first to share your thoughts!</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </aside>

    <script>
        function likePhoto(photoId, buttonElement) {
            // Send a background request to Python
            fetch(`/like/${photoId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Update all displayed like counts dynamically
                        document.querySelectorAll('.like-count-display').forEach(el => {
                            el.innerHTML = `<i class="ph-fill ph-heart text-red-500"></i> ${data.new_likes}`;
                        });

                        // Turn the heart on the button permanently red
                        let icon = buttonElement.querySelector('i');
                        icon.classList.remove('text-gray-400');
                        icon.classList.add('text-red-500', 'ph-fill');

                        // Add a little pop animation
                        icon.style.transform = 'scale(1.3)';
                        setTimeout(() => icon.style.transform = 'scale(1)', 200);
                    }
                });
        }

        function savePhoto(photoId, buttonElement) {
            fetch(`/save/${photoId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        let icon = buttonElement.querySelector('i');
                        if (data.action === 'saved') {
                            icon.classList.remove('ph');
                            icon.classList.remove('text-gray-400');
                            icon.classList.add('ph-fill');
                            icon.classList.add('text-brandAccent');
                        } else {
                            icon.classList.remove('ph-fill');
                            icon.classList.remove('text-brandAccent');
                            icon.classList.add('ph');
                            icon.classList.add('text-gray-400');
                        }

                        // Add a little pop animation
                        icon.style.transform = 'scale(1.3)';
                        setTimeout(() => icon.style.transform = 'scale(1)', 200);
                    }
                });
        }
    </script>
</body>

</html>